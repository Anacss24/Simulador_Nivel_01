const dadosGoverno = 
    [
      {
          "orgao": "Polícia Civil",
          "data": "05/01/2024",
          "valor": 5500.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Rodoviária Federal",
          "data": "02/01/2024",
          "valor": 6000.00,
          "status": "falha",
          
      },
      {
          "orgao": "Polícia Militar",
          "data": "03/01/2024",
          "valor": 4500.00,
          "status": "sucesso"
      },
      {
          "orgao": "Corpo de Bombeiros",
          "data": "04/01/2024",
          "valor": 7000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Guarda Municipal",
          "data": "05/01/2024",
          "valor": 3500.00,
          "status": "falha",
          "motivo": "Documentação incompleta"
      },
      {
          "orgao": "Receita Federal",
          "data": "06/01/2024",
          "valor": 8000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Ministério Público",
          "data": "07/01/2024",
          "valor": 9000.00,
          "status": "falha",
          "motivo": "Erro no sistema"
      },
      {
          "orgao": "Defesa Civil",
          "data": "08/01/2024",
          "valor": 4000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Detran",
          "data": "09/01/2024",
          "valor": 5000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Federal",
          "data": "10/01/2024",
          "valor": 6500.00,
          "status": "falha",
          "motivo": "Falta de recursos"
      },
      {
          "orgao": "Ibama",
          "data": "11/01/2024",
          "valor": 5500.00,
          "status": "sucesso"
      },
      {
          "orgao": "Anvisa",
          "data": "12/01/2024",
          "valor": 6000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Inmetro",
          "data": "13/01/2024",
          "valor": 3000.00,
          "status": "falha",
          "motivo": "Dados incorretos"
      },
      {
          "orgao": "Cetesb",
          "data": "14/01/2024",
          "valor": 7000.00,
          "status": "sucesso"
      },
      {
          "orgao": "Susep",
          "data": "15/01/2024",
          "valor": 8000.00,
          "status": "falha",
          "motivo": "Problemas técnicos"
      },
      {
          "orgao": "Polícia Civil",
          "data": "16/01/2024",
          "valor": 5200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Rodoviária Federal",
          "data": "17/01/2024",
          "valor": 6100.00,
          "status": "falha",
          "motivo": "Erro humano"
      },
      {
          "orgao": "Polícia Militar",
          "data": "18/01/2024",
          "valor": 4600.00,
          "status": "sucesso"
      },
      {
          "orgao": "Corpo de Bombeiros",
          "data": "19/01/2024",
          "valor": 7100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Guarda Municipal",
          "data": "20/01/2024",
          "valor": 3600.00,
          "status": "falha",
          "motivo": "Sistema fora do ar"
      },
      {
          "orgao": "Receita Federal",
          "data": "21/01/2024",
          "valor": 8100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Ministério Público",
          "data": "22/01/2024",
          "valor": 9100.00,
          "status": "falha",
          "motivo": "Recursos insuficientes"
      },
      {
          "orgao": "Defesa Civil",
          "data": "23/01/2024",
          "valor": 4100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Detran",
          "data": "24/01/2024",
          "valor": 5100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Federal",
          "data": "25/01/2024",
          "valor": 6600.00,
          "status": "falha",
          "motivo": "Problemas técnicos"
      },
      {
          "orgao": "Ibama",
          "data": "26/01/2024",
          "valor": 5600.00,
          "status": "sucesso"
      },
      {
          "orgao": "Anvisa",
          "data": "27/01/2024",
          "valor": 6100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Susep",
          "data": "28/01/2024",
          "valor": 3100.00,
          "status": "falha",
          "motivo": "Dados incorretos"
      },
      {
          "orgao": "Polícia Militar",
          "data": "29/01/2024",
          "valor": 7100.00,
          "status": "sucesso"
      },
      {
          "orgao": "Susep",
          "data": "30/01/2024",
          "valor": 8100.00,
          "status": "falha",
          "motivo": "Problemas técnicos"
      },
      {
          "orgao": "Polícia Civil",
          "data": "31/01/2024",
          "valor": 5300.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Rodoviária Federal",
          "data": "01/01/2024",
          "valor": 6200.00,
          "status": "falha",
          "motivo": "Erro humano"
      },
      {
          "orgao": "Polícia Militar",
          "data": "02/01/2024",
          "valor": 4700.00,
          "status": "sucesso"
      },
      {
          "orgao": "Corpo de Bombeiros",
          "data": "03/01/2024",
          "valor": 7200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Guarda Municipal",
          "data": "04/01/2024",
          "valor": 3700.00,
          "status": "falha",
          "motivo": "Sistema fora do ar"
      },
      {
          "orgao": "Receita Federal",
          "data": "05/01/2024",
          "valor": 8200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Ministério Público",
          "data": "06/01/2024",
          "valor": 9200.00,
          "status": "falha",
          "motivo": "Recursos insuficientes"
      },
      {
          "orgao": "Defesa Civil",
          "data": "07/01/2024",
          "valor": 4200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Detran",
          "data": "08/01/2024",
          "valor": 5200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Polícia Federal",
          "data": "09/01/2024",
          "valor": 6700.00,
          "status": "falha",
          "motivo": "Problemas técnicos"
      },
      {
          "orgao": "Ibama",
          "data": "10/01/2024",
          "valor": 5700.00,
          "status": "sucesso"
      },
      {
          "orgao": "Anvisa",
          "data": "11/01/2024",
          "valor": 6200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Inmetro",
          "data": "12/01/2024",
          "valor": 3200.00,
          "status": "falha",
          "motivo": "Dados incorretos"
      },
      {
          "orgao": "Cetesb",
          "data": "13/01/2024",
          "valor": 7200.00,
          "status": "sucesso"
      },
      {
          "orgao": "Susep",
          "data": "14/01/2024",
          "valor": 8200.00,
          "status": "falha",
          "motivo": "Problemas técnicos"
      }
  ]
  
const dadosJson = JSON.stringify(dadosGoverno)

const dadosObj = JSON.parse(dadosJson)
  
const transacoesValidas = dadosObj.filter(transacao => {
    return(transacao.status === "sucesso" || transacao.status === "falha");
  })
  
  // 1 - A quantidade total de repasses
  console.log("Total de repasses processados: " + transacoesValidas.length)

 /**
  * 2 - Análise de Transações por status
  * Repasses com Sucesso
  */
const quantidadesSucedidos = transacoesValidas.filter(elemento => elemento.status === 'sucesso')
const valorTotalSucedidos = quantidadesSucedidos.reduce((acumulador, elemento) => acumulador + elemento.valor, 0)
const quantidadeSucedidosOrgao = quantidadesSucedidos.reduce((contagem, dados) => {
    if(!contagem[dados.orgao]){
        contagem[dados.orgao] = {count: 0, valor: 0};
    }
    contagem[dados.orgao].count++;
    contagem[dados.orgao].valor += dados.valor;
    return contagem;

}, {});

// Exibir para o usuário
console.log("\n****************** Repasses bem sucedidos ******************\n")
console.log(`Quantidade total de repasses bem sucedidos: ${quantidadesSucedidos.length}\n`)
console.log(`Valor total dos repasses: ${valorTotalSucedidos}\n`)
Object.keys(quantidadeSucedidosOrgao).forEach(orgao =>{
    console.log(`${orgao}:`);
    console.log(`Total de repasses: ${quantidadeSucedidosOrgao[orgao].count}`);
    console.log(`Valor total de repasses: ${quantidadeSucedidosOrgao[orgao].valor}\n`);
})

// Repasses com falhas 
const quantidadesFalhas = transacoesValidas.filter(elemento => elemento.status === 'falha')
const valorTotalFalhas = quantidadesFalhas.reduce((acumulador, elemento) => acumulador + elemento.valor, 0)
const quantidadeFalhasOrgao = quantidadesFalhas.reduce((contagem, dados) => {
    if(!contagem[dados.orgao]){
        contagem[dados.orgao] = {count: 0, valor: 0};
    } 
    contagem[dados.orgao].count++;
    contagem[dados.orgao].valor += dados.valor;
    return contagem;

}, {});

// Exibir para o usuário
console.log("\n***************** Repasses com Falhas *****************\n")
console.log(`Quantidade total de repasses com falha: ${quantidadesFalhas.length}\n`)
console.log(`Valor total dos repasses: ${valorTotalFalhas}\n`)
Object.keys(quantidadeFalhasOrgao).forEach(orgao =>{
    console.log(`${orgao}:`);
    console.log(`Total de repasses: ${quantidadeFalhasOrgao[orgao].count}`);
    console.log(`Valor total de repasses: ${quantidadeFalhasOrgao[orgao].valor}\n`);
})

// Repasses com falhas e Motivo 
const falhasMotivo = transacoesValidas.filter(elemento => elemento.status === 'falha' && elemento.motivo)
const valorTotalFalhasMotivo = falhasMotivo.reduce((acumulador, elemento) => acumulador + elemento.valor, 0)
const quantidadeFalhasMotivo = falhasMotivo.reduce((contagem, dados) => {
    if(!contagem[dados.motivo]){
        contagem[dados.motivo] = {count: 0, valor: 0};
    }
    contagem[dados.motivo].count++; 
    contagem[dados.motivo].valor += dados.valor;
    return contagem;

}, {});

// Exibir para o usuário
console.log("\n***************** Repasses com Falhas e Motivo *****************\n")
console.log(`Quantidade total de repasses com falha e motivo: ${falhasMotivo.length}\n`)
console.log(`Valor total de repasses com falha e motivo: ${valorTotalFalhasMotivo}\n`)
Object.keys(quantidadeFalhasMotivo).forEach(orgao =>{
    if(quantidadeFalhasMotivo[orgao].count > 0){
       console.log(`${orgao}:`);
        console.log(`Total de repasses com motivo: ${quantidadeFalhasMotivo[orgao].count}`);
        console.log(`Valor total de repasses com motivo: ${quantidadeFalhasMotivo[orgao].valor}\n`);
    }
})

// 3 - Estatísticas de Repasses por critérios
const repasseComMaiorValor =  transacoesValidas.sort((elementoA, elementoB) => elementoB.valor - elementoA.valor);
const repasseComMenorValor =  transacoesValidas.sort((elementoA, elementoB) => elementoA.valor - elementoB.valor);
const orgaoMaisSucesso = Object.keys(quantidadeSucedidosOrgao).reduce((a,b) => quantidadeSucedidosOrgao[a].count > quantidadeSucedidosOrgao[b].count ? a:b );
const orgaoMaisFalha = Object.keys(quantidadeFalhasOrgao).reduce((a,b) => quantidadeFalhasOrgao[a].count > quantidadeFalhasOrgao[b].count ? a : b );
const falhaMotivo = Object.keys(quantidadeFalhasMotivo).reduce((a,b) => quantidadeFalhasMotivo[a].count > quantidadeFalhasMotivo[b].count ? a : b)

// Exibir para o usuário
console.log("\nDetalhes do repasse com maior valor: ", repasseComMaiorValor[repasseComMaiorValor.length -1])
console.log("\nDetalhes do repasse com menor valor: ", repasseComMenorValor[0])
console.log("\nOrgão com mais repasse de Sucesso: ", orgaoMaisSucesso)
console.log("\nOrgão com mais repasse de Falha: ", orgaoMaisFalha)
console.log("\nMotivo de falha com mais repasses: ", falhaMotivo)

// 4 - Apresentanção Automática 
function buscarTransacoesPorOrgao(orgao) {
    
    const transacoesFiltradas = transacoesValidas.filter(elemento => elemento.orgao === orgao);
  
    if (transacoesFiltradas.length > 0) {
      console.log(`\n******* Transações encontradas para o órgão: ${orgao} *******\n`);
      transacoesFiltradas.forEach((elemento) => {
        console.log(`  Órgão: ${elemento.orgao}`);
        console.log(`  Status: ${elemento.status}`);
        console.log(`  Valor: ${elemento.valor}`);
        console.log(`  Data: ${elemento.data}`);
        if(elemento.status === 'falha'){
            console.log(`  Motivo: ${elemento.motivo}`);
        }
        console.log('-----------------------');
      });
    } else {
      console.log(`\nNenhuma transação encontrada para o órgão: ${orgao}`);
    }
  }
  
buscarTransacoesPorOrgao('Inmetro');

// 5 - Tratamento de erros 
const transacoesSemMotivo = dadosGoverno.filter(elemento => elemento.status === 'falha' && !elemento.motivo )

if(transacoesSemMotivo.length > 0){
    console.log("\n********* Transação sem motivo de falha! ***********\n");
    transacoesSemMotivo.forEach((elemento) => {
        console.log(" Detalhes da transação:");
        console.log(`  Orgão: ${elemento.orgao}`);
        console.log(`  Data: ${elemento.data}`);
        console.log(`  Valor: ${elemento.valor}`);
        console.log(`  Status: ${elemento.status}`);
    });
} else {
    console.log("Não foram encontradas transações sem motivo da falha.");
};